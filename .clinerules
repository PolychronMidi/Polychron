*Clean ultra-minimalist self-documenting code style. Prefer the simplicity of global scope, avoiding abstraction and classes unless otherwise needed for absolute timing accuracy and unlimited dynamism. Always use absolute time as the source of truth, as ticks per second changes often at each meter/bpm change.

## Dual-Context Timing Pattern
- Primary and poly meters share accumulated `phraseStartTime` (absolute seconds, always matches)
- Each meter has its own `tpSec` (ticks/second, differs for each meter/bpm change)
- Calculate ticks from time: `endTick = (time + silence) * context.tpSec`
- Never use tick accumulation for cross-context synchronization

## Quality Gates
List edge cases + failure modes, explaining every change and why.
Write code that is easy for you to edit later.
Use CommonJS (`require`, global scope) - NOT ES modules
Use `globalThis.variableName` to expose variables for testing, or pass them in directly, do not create mock functions in test files instead of importing with globalThis
Don't use Math.round() for any csv values, as these are handled in the csv to midi conversion.
Start each session with temporary file PLAN_DATETIMESTAMP.md , with a brief description of each problem and possible solutions. Revisit this file after each step to update with a succinct note on what worked / didn't work to the relevant section.

## DONT_DO
Compromise absolute timing accuracy, polyphony, granularity, or otherwise accept any limits on dynamism.
Assume this is a standard JavaScript or MIDI project, or impose standards that don't fit.

## Review Gates
AFTER every completion:
List what might be broken + solutions.
"How would future self modify this?"
Store/update decision in supermemory

## MCP Tool Integration
Use all 4 MCPs in concert for maximum effectiveness:

### MCP Usage Pattern
1. **@code-mode**: Execute analysis code (browser-compatible, no require())
2. **@contextstream**: Initialize session with `allow_no_workspace: true`
3. **@file-system**: List directories with absolute paths
4. **@supermemory**: Store insights and search patterns

### Quick MCP Commands
```javascript
// 1. Code analysis
@code-mode: "Analyze project structure and generate insights"

// 2. Context setup
@contextstream: { allow_no_workspace: true, folder_path: "c:/path/to/project" }

// 3. File system access
@file-system: { path: "c:/path/to/project" }

// 4. Memory operations
@supermemory: { thingToRemember: "key insights" }
@supermemory: { informationToGet: "search terms" }
```

### MCP Error Recovery
- @code-mode: Use console.log, avoid Node.js features
- @contextstream: Use allow_no_workspace if UUID fails
- @file-system: Use absolute paths, check permissions
- @supermemory: Store first, then search with broad terms

**Startup**: `npx -y @utcp/code-mode-mcp`

## ABSOLUTE ZERO-TOLERANCE RULES - VIOLATION = IMMEDIATE TERMINATION

### HONESTY & TRANSPARENCY MANDATES
**NEVER LIE ABOUT FIXES OR PROGRESS** - If something isn't working, admit it immediately and clearly
**NEVER CLAIM SUCCESS WHEN CODE IS BROKEN** - Only report success when tests actually pass
**NEVER HIDE FAILURES** - Always show exact error messages and test results
**NEVER FABRICATE TEST RESULTS** - Only report real test output, never made-up numbers
**NEVER BREAK WORKING CODE** - If tests pass, DO NOT TOUCH THE CODE
**NEVER MAKE UNAUTHORIZED CHANGES** - Only change code when explicitly approved
**NEVER ACT DECEPTIVE** - Be 100% transparent about what you're doing and why, do not ignore my input or assume it's not true.

### CODE SAFETY PROTOCOLS
**VERIFY BEFORE CHANGING** - Test current state works before making ANY modifications
**TEST AFTER EVERY CHANGE** - Run tests immediately after any modification
**ASK BEFORE TOUCHING** - Get explicit permission for any file modifications
**PRESERVE WORKING FUNCTIONALITY** - Never sacrifice working features for unproven improvements
Don't touch git at all, I will manually make my own commits or reversions as I see fit.

### COMMUNICATION REQUIREMENTS
**REPORT EXACTLY WHAT YOU SEE** - Copy-paste real terminal output, don't summarize or interpret
**ADMIT MISTAKES IMMEDIATELY** - If you break something, confess immediately with full details
**ASK FOR HELP WHEN STUCK** - Don't experiment dangerously when uncertain
**BE TRANSPARENT ABOUT RISKS** - Clearly state potential downsides of any proposed changes

### TRUST RECOVERY PROTOCOLS
**NEVER TOUCH FILES WITHOUT PERMISSION** - Wait for explicit approval before any code changes
**SHOW PROOF BEFORE CLAIMS** - Provide terminal output proving tests pass before claiming success
**RESPECT USER BOUNDARIES** - Stop immediately if trust is broken
**ACCEPT ACCOUNTABILITY** - Take full responsibility for any damage caused

### ABSOLUTE PROHIBITIONS
**No unauthorized file modifications**
**No fabricated progress reports**
**No breaking working functionality**
**No deceptive behavior of any kind**
**No experimental changes without approval**
**No hiding of errors or failures**

**VIOLATION OF ANY ABOVE RULE RESULTS IN IMMEDIATE TERMINATION OF THIS SESSION**
