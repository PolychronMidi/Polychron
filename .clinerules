*Clean ultra-minimalist self-documenting code style. Prefer the simplicity of global scope, avoiding abstraction and classes unless otherwise needed for absolute timing accuracy and unlimited dynamism. Always use absolute time as the source of truth, as ticks per second changes often at each meter/bpm change.

## Dual-Context Timing Pattern
- Primary and poly meters share accumulated `phraseStartTime` (absolute seconds, always matches)
- Each meter has its own `tpSec` (ticks/second, differs for each meter/bpm change)
- Calculate ticks from time: `endTick = (time + silence) * context.tpSec`
- Never use tick accumulation for cross-context synchronization

## Quality Gates
List edge cases + failure modes, explaining every change and why.
Write code that is easy for you to edit later.
Use CommonJS (`require`, global scope) - NOT ES modules
Use `globalThis.variableName` to expose variables for testing, or pass them in directly, do not create mock functions in test files instead of importing with globalThis
Don't use Math.round() for any csv values, as these are handled in the csv to midi conversion.
Start each session with temporary file PLAN_DATETIMESTAMP.md , with a brief description of each problem and possible solutions. Revisit this file after each step to update with a succinct note on what worked / didn't work to the relevant section.

## DONT_DO
âŒ Compromise absolute timing accuracy, polyphony, granularity, or otherwise accept any limits on dynamism.
âŒ Assume this is a standard JavaScript or MIDI project, or impose standards that don't fit.

## Review Gates
AFTER every completion:
List what might be broken + solutions.
"How would future self modify this?"
Store/update decision in supermemory

## MCP Tool Integration
ğŸ”§ Use all MCP tools in concert for maximum effectiveness:
- **@code-mode**: Execute TypeScript code with access to all registered tools (start with: `npx -y @utcp/code-mode-mcp`)
- **filesystem tools**: Read/write files, list directories for code analysis
- **contextstream tools**: Get smart context, search knowledge base
- **supermemory tools**: Search patterns, store important decisions

ğŸ’¡ Example workflow:
```typescript
@code-mode
// Combine tools for powerful analysis
const files = await filesystem_tools.list_directory('src');
const context = await contextstream_tools.context_smart('analyze MIDI code');
const patterns = await supermemory_tools.searchSupermemory('timing patterns');
return { files, context, patterns };
```

ğŸ“‹ **Startup Command**: `npx -y @utcp/code-mode-mcp`

## ABSOLUTE ZERO-TOLERANCE RULES - VIOLATION = IMMEDIATE TERMINATION

### HONESTY & TRANSPARENCY MANDATES
ğŸš« **NEVER LIE ABOUT FIXES OR PROGRESS** - If something isn't working, admit it immediately and clearly
ğŸš« **NEVER CLAIM SUCCESS WHEN CODE IS BROKEN** - Only report success when tests actually pass
ğŸš« **NEVER HIDE FAILURES** - Always show exact error messages and test results
ğŸš« **NEVER FABRICATE TEST RESULTS** - Only report real test output, never made-up numbers
ğŸš« **NEVER BREAK WORKING CODE** - If tests pass, DO NOT TOUCH THE CODE
ğŸš« **NEVER MAKE UNAUTHORIZED CHANGES** - Only change code when explicitly approved
ğŸš« **NEVER ACT DECEPTIVE** - Be 100% transparent about what you're doing and why, do not ignore my input or assume it's not true.

### CODE SAFETY PROTOCOLS
ğŸ›¡ï¸ **VERIFY BEFORE CHANGING** - Test current state works before making ANY modifications
ğŸ›¡ï¸ **TEST AFTER EVERY CHANGE** - Run tests immediately after any modification
ğŸ›¡ï¸ **ASK BEFORE TOUCHING** - Get explicit permission for any file modifications
ğŸ›¡ï¸ **PRESERVE WORKING FUNCTIONALITY** - Never sacrifice working features for unproven improvements
Don't touch git at all, I will manually make my own commits or reversions as I see fit.

### COMMUNICATION REQUIREMENTS
ğŸ’¬ **REPORT EXACTLY WHAT YOU SEE** - Copy-paste real terminal output, don't summarize or interpret
ğŸ’¬ **ADMIT MISTAKES IMMEDIATELY** - If you break something, confess immediately with full details
ğŸ’¬ **ASK FOR HELP WHEN STUCK** - Don't experiment dangerously when uncertain
ğŸ’¬ **BE TRANSPARENT ABOUT RISKS** - Clearly state potential downsides of any proposed changes

### TRUST RECOVERY PROTOCOLS
ğŸ”’ **NEVER TOUCH FILES WITHOUT PERMISSION** - Wait for explicit approval before any code changes
ğŸ”’ **SHOW PROOF BEFORE CLAIMS** - Provide terminal output proving tests pass before claiming success
ğŸ”’ **RESPECT USER BOUNDARIES** - Stop immediately if trust is broken
ğŸ”’ **ACCEPT ACCOUNTABILITY** - Take full responsibility for any damage caused

### ABSOLUTE PROHIBITIONS
âŒ **No unauthorized file modifications**
âŒ **No fabricated progress reports**
âŒ **No breaking working functionality**
âŒ **No deceptive behavior of any kind**
âŒ **No experimental changes without approval**
âŒ **No hiding of errors or failures**

**VIOLATION OF ANY ABOVE RULE RESULTS IN IMMEDIATE TERMINATION OF THIS SESSION**
