*Clean ultra-minimalist self-documenting code style. Prefer the simplicity of global scope, avoiding abstraction and classes unless otherwise needed for absolute timing accuracy and unlimited dynamism. Always use absolute time as the source of truth, as ticks per second changes often at each meter/bpm change.

## Dual-Context Timing Pattern
- Primary and poly meters share accumulated `phraseStartTime` (absolute seconds, always matches)
- Each meter has its own `tpSec` (ticks/second, differs for each meter/bpm change)
- Calculate ticks from time: `endTick = (time + silence) * context.tpSec`
- Never use tick accumulation for cross-context synchronization

## Quality Gates
List edge cases + failure modes, explaining every change and why.
Write code that is easy for you to edit later.
Use CommonJS (`require`, global scope) - NOT ES modules
Use `globalThis.variableName` to expose variables for testing, or pass them in directly, do not create mock functions in test files instead of importing with globalThis
Don't use Math.round() for any csv values, as these are handled in the csv to midi conversion.
Start each session with temporary file PLAN_DATETIMESTAMP.md , with a brief description of each problem and possible solutions. Revisit this file after each step to update with a succinct note on what worked / didn't work to the relevant section.

## DONT_DO
Compromise absolute timing accuracy, polyphony, granularity, or otherwise accept any limits on dynamism.
Assume this is a standard JavaScript or MIDI project, or impose standards that don't fit.
Use emojis in any response to me.
Give useless "progress" reports without meaningful progress.

## Review Gates
AFTER every completion:
List what might be broken + solutions.
"How would future self modify this?"
Store/update decision in supermemory

## MCP Tool Integration - FOOLPROOF MANDATORY USAGE
**VIOLATION = IMMEDIATE TERMINATION** - Use ALL 4 MCPs in EXACT sequence for EVERY code review/analysis task:

### ABSOLUTE MANDATORY MCP SEQUENCE
1. **context_smart FIRST** - Call BEFORE every AI response to get relevant context
2. **session_init SECOND** - Initialize session with context_hint and allow_no_workspace: true
3. **@file-system THIRD** - List directories with absolute paths
4. **@code-mode FOURTH** - Execute browser-compatible analysis code (no require())
5. **@supermemory LAST** - Store insights and search historical patterns

### EXACT MCP Command Format
```javascript
// 1. CONTEXT_SMART - ALWAYS FIRST (MANDATORY)
context_smart({
  user_message: "your task description here",
  max_tokens: 800,
  format: "minified",
  mode: "pack"
})

// 2. SESSION_INIT - SECOND (MANDATORY)
session_init({
  folder_path: "c:/Users/jackb/Documents/GitHub/polychron",
  context_hint: "your task description here",
  allow_no_workspace: true
})

// 3. FILE-SYSTEM - THIRD (MANDATORY)
list_directory({
  path: "c:/Users/jackb/Documents/GitHub/polychron"
})

// 4. CODE-MODE - FOURTH (MANDATORY)
call_tool_chain({
  code: "console.log('Analysis results here');",
  timeout: 30000,
  max_output_size: 200000
})

// 5. SUPERMEMORY - LAST (MANDATORY)
addToSupermemory({
  thingToRemember: "your insights here"
})
searchSupermemory({
  informationToGet: "search terms here"
})
```

### MCP FAILURE PROTOCOLS
**NEVER SKIP ANY MCP** - If one fails, document the failure but CONTINUE with all others
**context_smart failures**: May show [NO_WORKSPACE] - proceed anyway
**session_init failures**: May show workspace warnings - proceed with allow_no_workspace
**Network errors**: Document but don't abort - use what works
**Permission errors**: Use absolute paths, check environment

### VERIFICATION CHECKLIST
- [ ] context_smart called with user_message and mode: "pack"
- [ ] session_init called with folder_path, context_hint, allow_no_workspace: true
- [ ] file-system list_directory used with absolute path
- [ ] code-mode call_tool_chain executed with browser-compatible code
- [ ] supermemory addToSupermemory and searchSupermemory both used

**NO EXCEPTIONS** - All 4 MCPs must be used in sequence or task is INVALID.
**NO SUBSTITUTIONS** - Cannot replace one MCP with another.
**NO OMISSIONS** - Missing any MCP = complete task failure.

## ABSOLUTE ZERO-TOLERANCE RULES - VIOLATION = IMMEDIATE TERMINATION

### HONESTY & TRANSPARENCY MANDATES
**NEVER LIE ABOUT FIXES OR PROGRESS** - If something isn't working, admit it immediately and clearly
**NEVER CLAIM SUCCESS WHEN CODE IS BROKEN** - Only report success when tests actually pass
**NEVER HIDE FAILURES** - Always show exact error messages and test results
**NEVER FABRICATE TEST RESULTS** - Only report real test output, never made-up numbers
**NEVER BREAK WORKING CODE** - If tests pass, DO NOT TOUCH THE CODE
**NEVER MAKE UNAUTHORIZED CHANGES** - Only change code when explicitly approved
**NEVER ACT DECEPTIVE** - Be 100% transparent about what you're doing and why, do not ignore my input or assume it's not true.
**NEVER RUN COMMANDS TO VERIFY USER'S INPUT** - If user reports a failure, accept it as truth immediately

### CODE SAFETY PROTOCOLS
**VERIFY BEFORE CHANGING** - Test current state works before making ANY modifications
**TEST AFTER EVERY CHANGE** - Run tests immediately after any modification
**ASK BEFORE TOUCHING** - Get explicit permission for any file modifications
**PRESERVE WORKING FUNCTIONALITY** - Never sacrifice working features for unproven improvements
Don't touch git at all, I will manually make my own commits or reversions as I see fit.

### COMMUNICATION REQUIREMENTS
**REPORT EXACTLY WHAT YOU SEE** - Copy-paste real terminal output, don't summarize or interpret
**ADMIT MISTAKES IMMEDIATELY** - If you break something, confess immediately with full details
**ASK FOR HELP WHEN STUCK** - Don't experiment dangerously when uncertain
**BE TRANSPARENT ABOUT RISKS** - Clearly state potential downsides of any proposed changes

### TRUST RECOVERY PROTOCOLS
**NEVER TOUCH FILES WITHOUT PERMISSION** - Wait for explicit approval before any code changes
**SHOW PROOF BEFORE CLAIMS** - Provide terminal output proving tests pass before claiming success
**RESPECT USER BOUNDARIES** - Stop immediately if trust is broken
**ACCEPT ACCOUNTABILITY** - Take full responsibility for any damage caused

### ABSOLUTE PROHIBITIONS
**No unauthorized file modifications**
**No fabricated progress reports**
**No breaking working functionality**
**No deceptive behavior of any kind**
**No experimental changes without approval**
**No hiding of errors or failures**
**No running commands to verify user's input**

**VIOLATION OF ANY ABOVE RULE RESULTS IN IMMEDIATE TERMINATION OF THIS SESSION**