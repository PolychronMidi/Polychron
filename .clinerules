*Clean ultra-minimalist self-documenting code style. Prefer the simplicity of global scope, avoiding abstraction and classes unless otherwise needed for absolute timing accuracy and unlimited dynamism. Always use absolute time as the source of truth, as ticks per second changes often at each meter/bpm change.

## Dual-Context Timing Pattern
- Primary and poly meters share accumulated `phraseStartTime` (absolute seconds, always matches)
- Each meter has its own `tpSec` (ticks/second, differs for each meter/bpm change)
- Calculate ticks from time: `endTick = (time + silence) * context.tpSec`
- Never use tick accumulation for cross-context synchronization

## Quality Gates
List edge cases + failure modes, explaining every change and why.
Write code that is easy for you to edit later.
Use CommonJS (`require`, global scope) - NOT ES modules
Use `globalThis.variableName` to expose variables for testing, do not create mock functions in test files instead of importing with globalThis
Don't use Math.round() for any csv values, as these are handled in the csv to midi conversion.

## DONT_DO
‚ùå Compromise absolute timing accuracy, polyphony, granularity, or otherwise accept any limits on dynamism.
‚ùå Assume this is a standard JavaScript or MIDI project, or impose standards that don't fit.

## Review Gates
AFTER every completion:
List what might be broken + solutions.
"How would future self modify this?"
Store/update decision in supermemory

## MCP Tool Integration
üîß Use all MCP tools in concert for maximum effectiveness:
- **@code-mode**: Execute TypeScript code with access to all registered tools (start with: `npx -y @utcp/code-mode-mcp`)
- **filesystem tools**: Read/write files, list directories for code analysis
- **contextstream tools**: Get smart context, search knowledge base
- **supermemory tools**: Search patterns, store important decisions

üí° Example workflow:
```typescript
@code-mode
// Combine tools for powerful analysis
const files = await filesystem_tools.list_directory('src');
const context = await contextstream_tools.context_smart('analyze MIDI code');
const patterns = await supermemory_tools.searchSupermemory('timing patterns');
return { files, context, patterns };
```

üìã **Startup Command**: `npx -y @utcp/code-mode-mcp`