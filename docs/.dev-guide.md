# Module Documentation

Documentation for Polychron TypeScript modules.

---

## üìö Documentation System Guide

### Overview

New .md files in /docs should be based on the template at /docs/.TEMPLATE.md

This documentation system uses **one unified helper script** to keep docs accurate and linked:

- **`scripts/docs.mjs`** ‚Äì Auto-links module references and injects real code snippets from source. Exposed via npm scripts: `npm run docs:fix` (one-shot), `npm run docs:watch` (watch mode), and `npm run docs:check` (validation only).

### Why This Matters

- **Auto-linking stays current** ‚Äì Plain module names are linked to both source code and documentation automatically
- **Code snippets stay in sync** ‚Äì Real source code is extracted and injected, preventing documentation drift
- **Minimal manual maintenance** ‚Äì Write module names plainly (e.g., stage.ts) and add snippet markers; the script does the rest

---

## üîß How It Works

### Auto-Linking + Snippet Injection (single pipeline)

The `docs.mjs` script scans all `.md` files in `docs/` and:

- **Auto-links** any module filename references to both source and docs using the format `module.ts ([code](../src/module.ts)) ([doc](module.md))`
- **Injects snippets** for any `<!-- BEGIN: snippet:Name --> ... <!-- END: snippet:Name -->` markers by pulling real code from `src/`

**Example prose before:**
```markdown
stage.ts coordinates with play.ts to process notes
```

**After running `npm run docs:fix`:**
```markdown
stage.ts ([code](../src/stage.ts)) ([doc](stage.md)) coordinates with play.ts ([code](../src/play.ts)) ([doc](play.md)) to process notes
```

**Example snippet marker setup:**
```markdown
#### `setTuningAndInstruments()`

<!-- BEGIN: snippet:Stage_setTuningAndInstruments -->

<!-- END: snippet:Stage_setTuningAndInstruments -->
```

**When to run:**
```bash
npm run docs:fix   # one-shot link + snippet injection
npm run docs:watch # watch mode while editing docs/source
npm run docs:check # validation only (no writes)
```

Run after:
- Updating source code that's documented with snippets
- Adding new snippet markers to docs
- Mentioning module names in prose or creating new doc files

---

## ‚úçÔ∏è Creating New Documentation

### Step 1: Create the Doc File

Create `docs/YourModule.md` with this structure:

```markdown
# YourModule.ts - Brief Description

> **Source**: `src/YourModule.ts`
> **Status**: Core Module / Utility / etc.
> **Dependencies**: module1.ts, module2.ts

## Overview

High-level explanation of what this module does...

## Key Exports

- `MainClass` - Description
- `helperFunction` - Description

## Core Methods

### `methodName(param1, param2)`

Description...

**Parameters:**
- `param1: Type` - Description
- `param2: Type` - Description

**Returns:** `ReturnType`

<!-- BEGIN: snippet:ClassName_methodName -->

<!-- END: snippet:ClassName_methodName -->

## Usage Example

\`\`\`typescript
import { MainClass } from './src/YourModule';
const instance = new MainClass();
\`\`\`

## Related Modules

- module1.ts - How they relate
- module2.ts - How they relate
```

### Step 2: Add Snippet Markers

Place markers where live code should appear. `docs.mjs` locates symbols by snippet name; prefer `File_symbolName` patterns (e.g., `Stage_setTuningAndInstruments`).

### Step 3: Run the Pipeline

```bash
npm run docs:fix
```

Use `npm run docs:watch` while iterating on docs or source. Use `npm run docs:check` in CI or for validation-only runs.

### Step 4: Add to Index

Update this file (`docs/README.md`) to include your new module in the appropriate section.

---

## üîÑ Maintenance Workflow

### When You Update Source Code

1. **Edit the TypeScript source** as needed
2. **Run docs pipeline**: `npm run docs:fix` (or `docs:watch` while iterating)
3. **Review the updated docs** to ensure code examples are still clear
4. **Update prose** if the API changed significantly

### When You Add Cross-References

1. **Write your documentation** mentioning module names naturally
2. **Run docs pipeline**: `npm run docs:fix`
3. **Verify links** are correct by clicking through them

### When Adding New Modules

1. **Follow "Creating New Documentation" steps** above
2. **Add snippet markers as needed**
3. **Run `npm run docs:fix`** to verify everything works
4. **Update this index** with the new module

---

## üö® Common Pitfalls

### ‚ùå Manually Creating Links

**Don't do this:**
```markdown
See [stage.ts](../src/stage.ts) for details
```

**Do this instead:**
```markdown
See stage.ts for details
```

Then run `npm run docs:fix` to auto-generate the full link format.
The script links every plain occurrence of a module name across a file (not just the first). If you need a name to remain unlinked (e.g., in literal examples), keep it inside backticks or a code block.

### ‚ùå Copying Code Snippets Manually

**Don't do this:**
```markdown
\`\`\`typescript
// Manually pasted code that will drift
function something() { ... }
\`\`\`
```

**Do this instead:**
```markdown
<!-- BEGIN: snippet:Module_something -->

<!-- END: snippet:Module_something -->
```

Then run `npm run docs:fix` to inject the real code.

### Authoring Rules (Quick Checklist)

- Write module references as plain names (e.g., stage.ts) in prose; avoid manual links
- Keep module names outside code fences if you want them auto-linked
- Use snippet markers for any code examples; do not paste code manually
- After edits: run `npm run docs:fix` (or `docs:watch` while iterating)
- Verify all occurrences are linked consistently (Architecture, Related Modules, etc.)

### ‚ùå Forgetting to Update Scripts

When adding a new module:
- ‚úÖ Add snippet markers for any code you want injected
- ‚úÖ Run `npm run docs:fix`
- ‚úÖ Update this README index

---

## üìã Quick Reference

| Task | Command |
|------|---------|
| Fix links + snippets (one-shot) | `npm run docs:fix` |
| Watch mode while editing | `npm run docs:watch` |
| Validate only (no writes) | `npm run docs:check` |

---
